K={BASE_RESOURCE:"/1.0/kb"},K.settings={url:"http://127.0.0.1:8080",username:"admin",password:"password",apiKey:"bob",apiSecret:"lazar"},K._merge=function(obj1,obj2){var obj3={};for(var attrname in obj1)obj3[attrname]=obj1[attrname];for(var attrname in obj2)obj3[attrname]=obj2[attrname];return obj3},K._get=function(uri,params,options,callback){K._request("GET",uri,K._merge({params:params},options),callback)},K._post=function(uri,body,params,options,callback){K._request("POST",uri,K._merge({params:params,body:body},options),callback)},K._put=function(uri,body,params,options,callback){K._request("PUT",uri,K._merge({params:params,body:body},options),callback)},K._delete=function(uri,params,options,callback){K._request("DELETE",uri,K._merge({params:params},options),callback)},K._request=function(method,relativeUri,options,callback){var url=K.settings.url+relativeUri;if(options.params){var pairs=[];for(var prop in options.params)options.params.hasOwnProperty(prop)&&pairs.push(encodeURIComponent(prop)+"="+encodeURIComponent(options.params[prop]));pairs.length>0&&(url=url+"?"+pairs.join("&"))}return K._requestWithAbsoluteUri(method,url,options,callback)},K._requestWithAbsoluteUri=function(method,absoluteUri,options,callback){var xmlhttp=new XMLHttpRequest;if(xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState){if(void 0===callback)return;if(xmlhttp.status>=200&&xmlhttp.status<300){var attributes={paginationMaxNbRecords:xmlhttp.getResponseHeader("X-Killbill-Pagination-MaxNbRecords"),paginationTotalNbRecords:xmlhttp.getResponseHeader("X-Killbill-Pagination-TotalNbRecords"),paginationNextPage:xmlhttp.getResponseHeader("X-Killbill-Pagination-NextPageUri"),location:xmlhttp.getResponseHeader("Location")};201==xmlhttp.status&&attributes.location?K._requestWithAbsoluteUri("GET",attributes.location,options,callback):callback(null,JSON.parse(xmlhttp.responseText),attributes)}else if(401==xmlhttp.status){var error=new Error("Unauthorized");callback(error,null)}else{var errorMsg=xmlhttp.responseText;if(errorMsg)try{var errorParsed=JSON.parse(xmlhttp.responseText);errorParsed.message&&(errorMsg=errorParsed.message)}catch(e){}else errorMsg="No response from server";var error=new Error(errorMsg);callback(error,null)}}},xmlhttp.open(method,absoluteUri,!0),void 0!==K.settings.username&&void 0!==K.settings.password){var token=K.settings.username+":"+K.settings.password,hash=btoa(token);xmlhttp.setRequestHeader("Authorization","Basic "+hash)}void 0!==K.settings.apiKey&&void 0!==K.settings.apiSecret&&(xmlhttp.setRequestHeader("X-Killbill-ApiKey",K.settings.apiKey),xmlhttp.setRequestHeader("X-Killbill-ApiSecret",K.settings.apiSecret)),options.user&&xmlhttp.setRequestHeader("X-Killbill-CreatedBy",options.user),options.reason&&xmlhttp.setRequestHeader("X-Killbill-Reason",options.reason),options.comment&&xmlhttp.setRequestHeader("X-Killbill-Comment",options.comment),xmlhttp.setRequestHeader("Accept","application/json"),xmlhttp.setRequestHeader("Content-Type","application/json"),xmlhttp.send(JSON.stringify(options.body))},K.Account={ACCOUNT_RESOURCE:K.BASE_RESOURCE+"/accounts",create:function(account,user,reason,comment,callback){K._post(K.Account.ACCOUNT_RESOURCE,account,{},{user:user,reason:reason,comment:comment},callback)},getById:function(id,callback){K._get(K.Account.ACCOUNT_RESOURCE+"/"+id,{},{},callback)},getByExternalKey:function(externalKey,callback){K._get(K.Account.ACCOUNT_RESOURCE,{externalKey:externalKey},{},callback)}},K.Payment={PAYMENT_RESOURCE:K.BASE_RESOURCE+"/payments",getByAccountId:function(accountId,callback){K._get(K.Account.ACCOUNT_RESOURCE+"/"+accountId+"/payments",{},{},callback)}};